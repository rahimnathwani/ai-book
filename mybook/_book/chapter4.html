<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Enter the Agent – AI Agents for the IT Professional</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter5.html" rel="next">
<link href="./chapter3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-27c261d06b905028a18691de25d09dde.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter3.html">Part II: From Workflows to Agents — A Critical Distinction</a></li><li class="breadcrumb-item"><a href="./chapter4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Enter the Agent</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AI Agents for the IT Professional</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Foundations — Understanding the AI Landscape</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The AI You Already Know</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Generative Revolution</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: From Workflows to Agents — A Critical Distinction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">AI-Powered Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Enter the Agent</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Agent Harnesses</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-defining-characteristic-of-agents" id="toc-the-defining-characteristic-of-agents" class="nav-link active" data-scroll-target="#the-defining-characteristic-of-agents"><span class="header-section-number">4.1</span> The Defining Characteristic of Agents</a>
  <ul class="collapse">
  <li><a href="#a-comparison" id="toc-a-comparison" class="nav-link" data-scroll-target="#a-comparison"><span class="header-section-number">4.1.1</span> A Comparison</a></li>
  <li><a href="#what-this-enables" id="toc-what-this-enables" class="nav-link" data-scroll-target="#what-this-enables"><span class="header-section-number">4.1.2</span> What This Enables</a></li>
  <li><a href="#what-this-requires" id="toc-what-this-requires" class="nav-link" data-scroll-target="#what-this-requires"><span class="header-section-number">4.1.3</span> What This Requires</a></li>
  </ul></li>
  <li><a href="#the-agentic-loop" id="toc-the-agentic-loop" class="nav-link" data-scroll-target="#the-agentic-loop"><span class="header-section-number">4.2</span> The Agentic Loop</a>
  <ul class="collapse">
  <li><a href="#the-loop-structure" id="toc-the-loop-structure" class="nav-link" data-scroll-target="#the-loop-structure"><span class="header-section-number">4.2.1</span> The Loop Structure</a></li>
  <li><a href="#a-detailed-example" id="toc-a-detailed-example" class="nav-link" data-scroll-target="#a-detailed-example"><span class="header-section-number">4.2.2</span> A Detailed Example</a></li>
  <li><a href="#what-makes-this-agentic" id="toc-what-makes-this-agentic" class="nav-link" data-scroll-target="#what-makes-this-agentic"><span class="header-section-number">4.2.3</span> What Makes This “Agentic”</a></li>
  <li><a href="#the-loop-in-practice" id="toc-the-loop-in-practice" class="nav-link" data-scroll-target="#the-loop-in-practice"><span class="header-section-number">4.2.4</span> The Loop in Practice</a></li>
  <li><a href="#what-the-loop-is-and-isnt" id="toc-what-the-loop-is-and-isnt" class="nav-link" data-scroll-target="#what-the-loop-is-and-isnt"><span class="header-section-number">4.2.5</span> What the Loop Is and Isn’t</a></li>
  </ul></li>
  <li><a href="#tools-the-agents-hands" id="toc-tools-the-agents-hands" class="nav-link" data-scroll-target="#tools-the-agents-hands"><span class="header-section-number">4.3</span> Tools: The Agent’s Hands</a>
  <ul class="collapse">
  <li><a href="#what-is-a-tool" id="toc-what-is-a-tool" class="nav-link" data-scroll-target="#what-is-a-tool"><span class="header-section-number">4.3.1</span> What Is a Tool?</a></li>
  <li><a href="#common-tool-types" id="toc-common-tool-types" class="nav-link" data-scroll-target="#common-tool-types"><span class="header-section-number">4.3.2</span> Common Tool Types</a></li>
  <li><a href="#how-agents-choose-tools" id="toc-how-agents-choose-tools" class="nav-link" data-scroll-target="#how-agents-choose-tools"><span class="header-section-number">4.3.3</span> How Agents Choose Tools</a></li>
  <li><a href="#tool-design-principles" id="toc-tool-design-principles" class="nav-link" data-scroll-target="#tool-design-principles"><span class="header-section-number">4.3.4</span> Tool Design Principles</a></li>
  <li><a href="#tool-limitations-and-safety" id="toc-tool-limitations-and-safety" class="nav-link" data-scroll-target="#tool-limitations-and-safety"><span class="header-section-number">4.3.5</span> Tool Limitations and Safety</a></li>
  <li><a href="#what-tools-are-and-arent" id="toc-what-tools-are-and-arent" class="nav-link" data-scroll-target="#what-tools-are-and-arent"><span class="header-section-number">4.3.6</span> What Tools Are and Aren’t</a></li>
  </ul></li>
  <li><a href="#workflows-vs.-agents-when-to-use-which" id="toc-workflows-vs.-agents-when-to-use-which" class="nav-link" data-scroll-target="#workflows-vs.-agents-when-to-use-which"><span class="header-section-number">4.4</span> Workflows vs.&nbsp;Agents: When to Use Which</a>
  <ul class="collapse">
  <li><a href="#use-workflows-when" id="toc-use-workflows-when" class="nav-link" data-scroll-target="#use-workflows-when"><span class="header-section-number">4.4.1</span> Use Workflows When:</a></li>
  <li><a href="#use-agents-when" id="toc-use-agents-when" class="nav-link" data-scroll-target="#use-agents-when"><span class="header-section-number">4.4.2</span> Use Agents When:</a></li>
  <li><a href="#the-hybrid-approach-agents-that-invoke-workflows" id="toc-the-hybrid-approach-agents-that-invoke-workflows" class="nav-link" data-scroll-target="#the-hybrid-approach-agents-that-invoke-workflows"><span class="header-section-number">4.4.3</span> The Hybrid Approach: Agents That Invoke Workflows</a></li>
  <li><a href="#the-spectrum" id="toc-the-spectrum" class="nav-link" data-scroll-target="#the-spectrum"><span class="header-section-number">4.4.4</span> The Spectrum</a></li>
  </ul></li>
  <li><a href="#what-weve-learned" id="toc-what-weve-learned" class="nav-link" data-scroll-target="#what-weve-learned"><span class="header-section-number">4.5</span> What We’ve Learned</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter3.html">Part II: From Workflows to Agents — A Critical Distinction</a></li><li class="breadcrumb-item"><a href="./chapter4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Enter the Agent</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-enter-agent" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Enter the Agent</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>The fundamental shift in how AI systems operate</em></p>
<p>We’ve arrived at the pivot point. Everything in the previous chapters—classification models, generative AI, workflows—has been building to this moment. We’re about to explore the concept that transforms AI from a tool your software uses into something fundamentally different: an <strong>agent</strong>.</p>
<p>The shift is conceptually simple but profound in its implications: <strong>What if the AI model makes the decisions about what to do next?</strong></p>
<p>This chapter introduces the defining characteristic of agents, explores how they operate, and clarifies the critical distinction between using AI in workflows and deploying AI as agents.</p>
<section id="the-defining-characteristic-of-agents" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-defining-characteristic-of-agents"><span class="header-section-number">4.1</span> The Defining Characteristic of Agents</h2>
<p>Let’s start with the clearest possible definition:</p>
<p><strong>An AI agent is a system where the AI model decides which tools to call and what actions to take in pursuit of a goal.</strong></p>
<p>That’s it. That’s the fundamental distinction.</p>
<p>In a workflow: The software decides when to call the AI and what to do with the results.</p>
<p>In an agent: The AI decides what to do next, including whether and when to use the tools available to it.</p>
<section id="a-comparison" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="a-comparison"><span class="header-section-number">4.1.1</span> A Comparison</h3>
<p><strong>Workflow:</strong></p>
<pre><code>Software: "Classify this customer email"
AI: "This is a billing issue, high priority"
Software: "Thank you. I'll route it to the billing queue and
          generate a suggested response"
AI: [not involved in these decisions]
Software: "Here's what I generated. Now I'll store it in the
          database and notify the on-call rep"</code></pre>
<p><strong>Agent:</strong></p>
<pre><code>You: "Handle this customer email appropriately"
Agent: [reads email] "This is a billing issue. Let me check
       the customer's account history first"
Agent: [calls account lookup tool]
Agent: [reviews results] "I see they've had billing problems
       before. Let me check our knowledge base for the
       standard resolution process"
Agent: [searches knowledge base]
Agent: [reviews findings] "I have enough information. I'll
       draft a response, route this to the priority queue,
       and attach the relevant account history"
Agent: [calls email drafting tool, queue routing tool,
       attachment tool]
Agent: "Task complete. Email routed to priority billing queue
       with drafted response and full context"</code></pre>
<p>Notice the difference:</p>
<ul>
<li><strong>Workflow</strong>: Software pre-programmed every step</li>
<li><strong>Agent</strong>: AI reasoned through the situation and decided its own approach</li>
</ul>
<p>The agent still used tools (account lookup, knowledge base search, email drafting). But the agent chose which tools to use, in what order, based on what it discovered along the way.</p>
</section>
<section id="what-this-enables" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="what-this-enables"><span class="header-section-number">4.1.2</span> What This Enables</h3>
<p>When the AI model controls the decision-making:</p>
<ol type="1">
<li><strong>Adaptability</strong>: The agent can handle situations the designer didn’t explicitly anticipate</li>
<li><strong>Multi-step reasoning</strong>: The agent can chain together multiple actions toward a goal</li>
<li><strong>Context-aware decisions</strong>: The agent can adjust its approach based on what it finds</li>
<li><strong>Tool composition</strong>: The agent can combine tools in novel ways</li>
<li><strong>Goal-oriented behavior</strong>: You specify what you want achieved, not how to achieve it</li>
</ol>
</section>
<section id="what-this-requires" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="what-this-requires"><span class="header-section-number">4.1.3</span> What This Requires</h3>
<p>This shift also demands new approaches:</p>
<ol type="1">
<li><strong>Trust</strong>: You must trust the agent to make reasonable decisions</li>
<li><strong>Monitoring</strong>: You need to observe what the agent is doing, not just what it produces</li>
<li><strong>Constraints</strong>: You must define boundaries around what the agent can do</li>
<li><strong>Error handling</strong>: The agent might take unexpected paths, including wrong ones</li>
<li><strong>Tool design</strong>: Tools must be self-descriptive so the agent knows when to use them</li>
</ol>
</section>
</section>
<section id="the-agentic-loop" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="the-agentic-loop"><span class="header-section-number">4.2</span> The Agentic Loop</h2>
<p>Agents operate through a fundamental pattern called the <strong>agentic loop</strong> (also called the ReAct loop, for Reasoning + Acting). Understanding this loop is essential for working with agents effectively.</p>
<section id="the-loop-structure" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="the-loop-structure"><span class="header-section-number">4.2.1</span> The Loop Structure</h3>
<pre><code>1. Observe the current state
2. Reason about what to do next
3. Decide on an action
4. Execute the action (call a tool)
5. Observe the result
6. Repeat until the task is complete (or limits are reached)</code></pre>
<p>This is fundamentally different from executing a predetermined sequence of steps. The agent is continuously assessing the situation and deciding its next move.</p>
</section>
<section id="a-detailed-example" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="a-detailed-example"><span class="header-section-number">4.2.2</span> A Detailed Example</h3>
<p>Let’s walk through an agent completing a task: “Find the total amount spent by customer ID 12345 last month and send them a thank you email if it’s over $1000.”</p>
<p><strong>Iteration 1:</strong> - <strong>Observe</strong>: I have a task about customer 12345, needing to check spending and conditionally send email - <strong>Reason</strong>: I need spending data first. I should query the database - <strong>Decide</strong>: Use the <code>query_database</code> tool - <strong>Execute</strong>: <code>query_database(customer_id=12345, date_range="last_month")</code> - <strong>Result</strong>: $1,247.89</p>
<p><strong>Iteration 2:</strong> - <strong>Observe</strong>: Customer 12345 spent $1,247.89 last month (over $1000 threshold) - <strong>Reason</strong>: This qualifies for a thank you email. I should personalize it with the actual amount - <strong>Decide</strong>: Use the <code>send_email</code> tool - <strong>Execute</strong>: <code>send_email(to=customer_12345_email, subject="Thank you!", body="Thank you for your $1,247.89 in business last month...")</code> - <strong>Result</strong>: Email sent successfully</p>
<p><strong>Iteration 3:</strong> - <strong>Observe</strong>: I’ve determined the spend amount and sent the qualifying thank you email - <strong>Reason</strong>: The task is complete - <strong>Decide</strong>: Stop - <strong>Execute</strong>: Return final summary</p>
</section>
<section id="what-makes-this-agentic" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="what-makes-this-agentic"><span class="header-section-number">4.2.3</span> What Makes This “Agentic”</h3>
<p>The agent made several autonomous decisions:</p>
<ol type="1">
<li><strong>Sequencing</strong>: It decided to query the database before sending the email (obvious here, but the agent reasoned through it rather than following a script)</li>
<li><strong>Conditional logic</strong>: It evaluated whether $1,247.89 &gt; $1,000 and decided to send the email</li>
<li><strong>Tool selection</strong>: It chose which tools to use from those available</li>
<li><strong>Content generation</strong>: It composed an email with the specific amount</li>
<li><strong>Completion detection</strong>: It recognized when the task was done</li>
</ol>
<p>In a workflow, every one of these decisions would be explicitly coded. In an agent, the AI model made them based on reasoning.</p>
</section>
<section id="the-loop-in-practice" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="the-loop-in-practice"><span class="header-section-number">4.2.4</span> The Loop in Practice</h3>
<p>Real agent implementations handle additional complexities:</p>
<p><strong>Context management</strong>: Each observation and action is added to the context window, so the agent “remembers” what it’s done.</p>
<p><strong>Error handling</strong>: If a tool call fails, the agent observes the error and can reason about what to try next.</p>
<p><strong>Iteration limits</strong>: To prevent infinite loops, agents typically have a maximum number of iterations.</p>
<p><strong>Cost limits</strong>: Since each iteration involves LLM calls, agents may have budget limits.</p>
<p><strong>Verification steps</strong>: The agent might use a tool to verify results before proceeding.</p>
</section>
<section id="what-the-loop-is-and-isnt" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="what-the-loop-is-and-isnt"><span class="header-section-number">4.2.5</span> What the Loop Is and Isn’t</h3>
<p><strong>What the agentic loop is:</strong> - An iterative cycle of reasoning and acting - The mechanism that gives agents their adaptability - A framework for multi-step problem-solving - Fundamentally non-deterministic (same task might be approached differently)</p>
<p><strong>What the agentic loop is not:</strong> - A predetermined sequence of steps - Guaranteed to take the optimal path - Limited to a single iteration (most real tasks need multiple) - Foolproof (the agent can reason incorrectly)</p>
</section>
</section>
<section id="tools-the-agents-hands" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="tools-the-agents-hands"><span class="header-section-number">4.3</span> Tools: The Agent’s Hands</h2>
<p>An agent without tools is just a chatbot—it can reason and generate text, but it can’t affect the world or access external information. <strong>Tools</strong> are what transform an LLM into an agent capable of doing work.</p>
<section id="what-is-a-tool" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="what-is-a-tool"><span class="header-section-number">4.3.1</span> What Is a Tool?</h3>
<p>A tool is a function that the agent can call. From the agent’s perspective, a tool is defined by:</p>
<ol type="1">
<li><strong>Name</strong>: A clear, descriptive identifier</li>
<li><strong>Description</strong>: What the tool does and when to use it</li>
<li><strong>Parameters</strong>: What inputs it requires (with descriptions)</li>
<li><strong>Return value</strong>: What information it provides back</li>
</ol>
<p><strong>Example tool definition:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"query_customer_database"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Queries the customer database for information about a specific customer. Use this when you need customer details, order history, or account status."</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"parameters"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"customer_id"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"string"</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"The unique customer identifier"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"include_orders"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"boolean"</span><span class="fu">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Whether to include order history (optional, defaults to false)"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"returns"</span><span class="fu">:</span> <span class="st">"Customer object with requested information"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The agent reads these descriptions and decides when to use the tool based on its task.</p>
</section>
<section id="common-tool-types" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="common-tool-types"><span class="header-section-number">4.3.2</span> Common Tool Types</h3>
<p><strong>Information retrieval:</strong> - Database queries - Web searches - File reading - API calls to external services - Knowledge base searches</p>
<p><strong>Actions and modifications:</strong> - Sending emails or messages - Creating or updating database records - File writing - Making API calls that change state - Running shell commands</p>
<p><strong>Computation and analysis:</strong> - Code execution (running Python, SQL, etc.) - Data transformation - Mathematical calculations - Report generation</p>
<p><strong>Specialized domain tools:</strong> - Medical diagnosis lookups - Legal research databases - Financial data APIs - Inventory management systems</p>
</section>
<section id="how-agents-choose-tools" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="how-agents-choose-tools"><span class="header-section-number">4.3.3</span> How Agents Choose Tools</h3>
<p>This is where the magic happens. The agent:</p>
<ol type="1">
<li><strong>Reads the available tool descriptions</strong> (these are in its context)</li>
<li><strong>Considers the current task</strong> and what’s been done so far</li>
<li><strong>Reasons about which tool would help</strong> make progress</li>
<li><strong>Decides on a specific tool and parameters</strong></li>
<li><strong>Calls the tool</strong></li>
<li><strong>Interprets the result</strong> and continues reasoning</li>
</ol>
<p><strong>Example decision-making process:</strong></p>
<p>Task: “Analyze sales trends for Q4”</p>
<p>Agent’s reasoning: - “I need sales data. Looking at available tools…” - “I see <code>query_database</code>, <code>read_file</code>, and <code>web_search</code>” - “The task is about our sales data, so <code>web_search</code> isn’t appropriate” - “<code>query_database</code> is described as accessing sales records—that’s what I need” - “I’ll query for Q4 sales data”</p>
<p>The agent doesn’t have hardcoded logic saying “sales analysis → database query.” It reads the tool descriptions and reasons about which tool matches the need.</p>
</section>
<section id="tool-design-principles" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="tool-design-principles"><span class="header-section-number">4.3.4</span> Tool Design Principles</h3>
<p>Since agents choose tools based on descriptions, good tool design is crucial:</p>
<p><strong>Clear, distinctive names</strong>: <code>send_email</code> is better than <code>tool_5</code></p>
<p><strong>Precise descriptions</strong>: Explain exactly what the tool does and when to use it - Good: “Sends an email to a specified recipient with subject and body. Use this when you need to communicate with users or stakeholders via email.” - Bad: “Handles email stuff”</p>
<p><strong>Well-documented parameters</strong>: Every parameter needs a clear description - Good: <code>customer_id (string): The unique identifier for the customer, found in the customer database</code> - Bad: <code>id (string): The ID</code></p>
<p><strong>Appropriate scope</strong>: Each tool should do one thing well - Good: Separate tools for <code>send_email</code> and <code>schedule_email</code> - Bad: One mega-tool that does email, SMS, notifications, and calendar events</p>
<p><strong>Useful return values</strong>: Return information the agent might need for reasoning - Good: <code>{"email_sent": true, "message_id": "abc123", "recipient_confirmed": "user@example.com"}</code> - Bad: <code>{"status": "ok"}</code></p>
</section>
<section id="tool-limitations-and-safety" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="tool-limitations-and-safety"><span class="header-section-number">4.3.5</span> Tool Limitations and Safety</h3>
<p>Tools are powerful, which means they require careful consideration:</p>
<p><strong>The agent can only use tools you provide</strong>: An agent without a <code>send_email</code> tool cannot send emails, no matter how much reasoning it does.</p>
<p><strong>The agent might use tools incorrectly</strong>: It might misunderstand a description, pass wrong parameters, or use a tool at the wrong time.</p>
<p><strong>The agent might not use a tool when it should</strong>: If the description doesn’t clearly match the agent’s interpretation of the task, it might overlook a useful tool.</p>
<p><strong>Tools have real effects</strong>: If you give an agent a <code>delete_database_table</code> tool, it might use it. Tool design is security design.</p>
<p>We’ll explore tool design in much more depth in Chapter 7, and security considerations in Chapter 13.</p>
</section>
<section id="what-tools-are-and-arent" class="level3" data-number="4.3.6">
<h3 data-number="4.3.6" class="anchored" data-anchor-id="what-tools-are-and-arent"><span class="header-section-number">4.3.6</span> What Tools Are and Aren’t</h3>
<p><strong>What tools are:</strong> - Capabilities you grant to the agent - Functions the agent can call to interact with the world - Described in natural language for the agent to understand - The mechanism that makes agents useful for real work</p>
<p><strong>What tools are not:</strong> - Guaranteed to be used (the agent chooses) - Foolproof (the agent might use them wrongly) - A complete specification of the agent’s behavior (the agent still reasons) - Traditional API calls from the software (the AI decides when to call them)</p>
</section>
</section>
<section id="workflows-vs.-agents-when-to-use-which" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="workflows-vs.-agents-when-to-use-which"><span class="header-section-number">4.4</span> Workflows vs.&nbsp;Agents: When to Use Which</h2>
<p>We now have enough context to address the critical question: When should you use a workflow versus an agent?</p>
<section id="use-workflows-when" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="use-workflows-when"><span class="header-section-number">4.4.1</span> Use Workflows When:</h3>
<p><strong>You know exactly what needs to happen</strong> - Processing invoices that follow standard formats - Routing support tickets based on clear categories - Sending scheduled reports with predictable content</p>
<p><strong>Consistency is critical</strong> - Regulatory compliance requirements demand identical processing - Brand guidelines must be followed precisely - Every instance must be handled the same way</p>
<p><strong>Volume is high and cost matters</strong> - Processing millions of transactions where agent reasoning overhead would be expensive - Margins are thin and you need efficient execution</p>
<p><strong>The problem domain is stable</strong> - The scenarios don’t change frequently - New edge cases are rare - The workflow can be updated occasionally when needed</p>
<p><strong>Auditability requires explicit logic</strong> - You need to point to specific code that explains decisions - Compliance demands transparent, predetermined rules</p>
</section>
<section id="use-agents-when" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="use-agents-when"><span class="header-section-number">4.4.2</span> Use Agents When:</h3>
<p><strong>The path to the goal isn’t predetermined</strong> - Researching a complex question that might require different sources depending on what you find - Debugging a problem where the next step depends on what each test reveals - Handling customer issues that might involve multiple interconnected problems</p>
<p><strong>Adaptability to variation is important</strong> - Inputs come in many different formats - Each instance might require a different approach - New scenarios emerge frequently</p>
<p><strong>Multi-step reasoning is required</strong> - The task requires chaining together multiple sub-tasks - Each step informs what should happen next - The sequence can’t be predicted in advance</p>
<p><strong>Human-like judgment adds value</strong> - The task benefits from contextual understanding - There are nuances that are hard to code explicitly - The “right” answer depends on factors that are difficult to enumerate</p>
<p><strong>You’re willing to trade control for capability</strong> - You can accept some unpredictability - You can implement appropriate safeguards - The benefits of flexibility outweigh the risks of non-determinism</p>
</section>
<section id="the-hybrid-approach-agents-that-invoke-workflows" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="the-hybrid-approach-agents-that-invoke-workflows"><span class="header-section-number">4.4.3</span> The Hybrid Approach: Agents That Invoke Workflows</h3>
<p>Here’s a sophisticated pattern: agents that have workflows as tools.</p>
<p><strong>Example: Customer support agent</strong></p>
<p>The agent has these tools: - <code>check_account_status</code> (workflow: query database, apply business rules, return structured status) - <code>process_refund</code> (workflow: validate request, check policy, execute refund, send confirmation) - <code>search_knowledge_base</code> (workflow: embed query, semantic search, rank results, return top matches) - <code>escalate_to_human</code> (workflow: create ticket, route to appropriate team, notify)</p>
<p>The <strong>agent</strong> reasons about the customer’s issue and decides which tools to use, in what order.</p>
<p>Each <strong>tool</strong> is a reliable workflow that does one thing well and predictably.</p>
<p>This combines the best of both: - Agent flexibility and reasoning for the overall task - Workflow reliability and auditability for critical operations</p>
</section>
<section id="the-spectrum" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="the-spectrum"><span class="header-section-number">4.4.4</span> The Spectrum</h3>
<p>Think of it as a spectrum rather than a binary choice:</p>
<pre><code>Pure Workflow ← → Pure Agent

Traditional software with     Agents that invoke      Agents with direct
AI components at specific     workflows for critical  tool access to all
predetermined points          operations              systems</code></pre>
<p>Most production systems will land somewhere in the middle, using agents for reasoning and decision-making while delegating well-defined operations to workflows.</p>
</section>
</section>
<section id="what-weve-learned" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="what-weve-learned"><span class="header-section-number">4.5</span> What We’ve Learned</h2>
<p>The shift from workflows to agents represents a fundamental change in how we build AI systems:</p>
<p><strong>Workflows:</strong> - Software makes decisions - AI provides capabilities - Predetermined logic - Predictable behavior - Explicit control</p>
<p><strong>Agents:</strong> - AI makes decisions - Tools provide capabilities - Emergent behavior through reasoning - Adaptive approach - Guided autonomy</p>
<p>The agentic loop—observe, reason, act, repeat—is what gives agents their power. Tools are what let them do real work. And the design choice between workflows and agents depends on your specific needs around predictability, adaptability, and control.</p>
<p>But agents don’t exist in isolation. They need infrastructure to run, interfaces for humans to interact with them, and systems to manage their execution. That infrastructure is called an <strong>agent harness</strong>, and it’s what makes agents practical for real-world use.</p>
<p>In the next chapter, we’ll explore what agent harnesses do, how they’ve evolved, and why the current state of the art is dominated by CLI-based systems designed for coding tasks—which turn out to be much more general-purpose than they first appear.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter3.html" class="pagination-link" aria-label="AI-Powered Workflows">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">AI-Powered Workflows</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter5.html" class="pagination-link" aria-label="Agent Harnesses">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Agent Harnesses</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>